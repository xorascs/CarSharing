@model CarSharing.Models.Car

@{
    ViewData["Title"] = "Details";
}

<style>
    .img-thumbnail {
        cursor: pointer;
        max-width: 100%;
        height: auto;
    }
</style>

<p><a asp-action="Index" class="text-decoration-none text-secondary">Cars</a> / <a asp-action="Details" class="text-decoration-none text-secondary">@Model.Brand!.Name @Model.Model</a></p>

<div class="row">
    <div class="col-sm-8">
        <!-- Carousel -->
        <div id="demo" class="carousel slide w-100" data-bs-ride="carousel">

            <!-- Indicators/dots -->
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
                @for (int i = 1; i < Model.ImagePaths.Count; i++)
                {
                    <button type="button" data-bs-target="#demo" data-bs-slide-to="@i"></button>
                }
            </div>

            <!-- The slideshow/carousel -->
            <div class="carousel-inner">
                @if (Model.ImagePaths != null && Model.ImagePaths.Any())
                {
                    bool isFirstItem = true;
                    foreach (var imagePath in Model.ImagePaths)
                    {
                        if (isFirstItem)
                        {
                            <div class="carousel-item active">
                                <img src="~/uploads/@imagePath" alt="Existing Image" class="d-block w-100 img-thumbnail" style="height: 500px; width: 100%; object-fit: cover;" data-bs-toggle="modal" data-bs-target="#imageModal" />
                            </div>
                        }
                        else
                        {
                            <div class="carousel-item">
                                <img src="~/uploads/@imagePath" alt="Existing Image" class="d-block w-100 img-thumbnail" style="height: 500px; width: 100%; object-fit: cover;" data-bs-toggle="modal" data-bs-target="#imageModal" />
                            </div>
                        }
                        isFirstItem = false;
                    }
                }
            </div>

            <!-- Left and right controls/icons -->
            <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
        <table class="table table-striped my-4">
            <tbody>
                <tr>
                    <th class="col-sm-4">@Html.DisplayNameFor(model => model.Brand)</th>
                    <td class="col-sm-8">@Html.DisplayFor(model => model.Brand!.Name)</td>
                </tr>
                <tr>
                    <th class="col-sm-4">@Html.DisplayNameFor(model => model.FuelType)</th>
                    <td class="col-sm-8">@Html.DisplayFor(model => model.FuelType)</td>
                </tr>
                <tr>
                    <th class="col-sm-4">@Html.DisplayNameFor(model => model.Model)</th>
                    <td class="col-sm-8">@Html.DisplayFor(model => model.Model)</td>
                </tr>
                <tr>
                    <th class="col-sm-4">@Html.DisplayNameFor(model => model.Color)</th>
                    <td class="col-sm-8">@Html.DisplayFor(model => model.Color)</td>
                </tr>
                <tr>
                    <th class="col-sm-4">@Html.DisplayNameFor(model => model.ManufacturingDate)</th>
                    <td class="col-sm-8">@Html.DisplayFor(model => model.ManufacturingDate)</td>
                </tr>
            </tbody>
        </table>
        <h6>Note: minimal rental time is 4 hours!</h6>
    </div>
    <div class="col-sm-4">
        <h1 class="display-4 d-inline-block my-3">@Model.Brand!.Name @Model.Model 
            @if (Model.FuelType == FuelTypes.Electric)
            {
                <span class="badge bg-success rounded-circle fs-4 align-middle">E</span>
            }
        </h1>

        <h4 class="text-secondary">@Model.FuelType, @Model.Color</h4>
        <h4 class="text-secondary">Manufacturing Date: @Model.ManufacturingDate.ToShortDateString()</h4>
        <h4 class="badge bg-light text-dark fs-3 w-100 my-4">@Model.Price $/h</h4>
        <div>
            @if (ViewBag.isAdmin == 1 && ViewBag.Name != null)
            {
                <a asp-action="Edit" asp-route-id="@Model!.Id" class="btn btn-primary w-100 my-2">Edit</a>
            }
            <a asp-action="Rent" class="btn btn-success w-100 my-2">Rent a Car</a>
            <a asp-action="Index" class="btn btn-secondary w-100 my-2">Back to List</a>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <img src="" id="modalImage" class="img-fluid mx-auto d-block" style="width: 1500px;" alt="Modal Image" />
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Set modal image source when an image thumbnail is clicked
        var imageThumbnails = document.querySelectorAll('.img-thumbnail');
        var modalImage = document.getElementById('modalImage');

        imageThumbnails.forEach(function (thumbnail) {
            thumbnail.addEventListener('click', function () {
                modalImage.src = thumbnail.src;
            });
        });
    </script>
}